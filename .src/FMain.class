' Gambas class file

Private mySnake As Snake
Private steps As Integer
'Private myChannel1 As Channel
' Private myChannel2 As Channel
' Private myChannel3 As Channel
' Private myChannel4 As Channel
' Private backgroundMusic As Sound
' Private growingUpMusic As Sound
' Private gameOverMusic As Sound
' Private movingMusic As Sound

Public Sub Form_Open()

  ' Channels.Count = 4
  ' myChannel1 = Channels[0]
  ' myChannel2 = Channels[1]
  ' myChannel3 = Channels[2]
  ' myChannel4 = Channels[3]
  ' backgroundMusic = Sound.Load("./assets/background.wav")
  ' growingUpMusic = Sound.Load("./assets/growUp.wav")
  ' gameOverMusic = Sound.Load("./assets/gameOver.wav")
  ' movingMusic = Sound.Load("./assets/move.wav")
  ' Channels.Volume = 100
  ' growingUpMusic.Volume = 120
  ' movingMusic.Volume = 120
  msgBox.Hide()
  continue.Hide()
  pause.Hide()

End

Public Sub play_Click()

  lblPoints.Text = "0"
  lblTime.Text = "0"
  'myChannel2.Stop()
  msgBox.Hide()
  play.Hide()
  continue.Show()
  pause.Show()
  mySnake = New Snake(200, 300, Color.Yellow, "d")
  steps = 1
  'myChannel1.Play(backgroundMusic)
  myTimer.Start()
  
End

Public Sub myTimer_Timer()
  
  If mySnake.isInHimself() = True Or mySnake.isOutOfClient(game) = True Then
   
    ' myChannel1.Stop()
    ' myChannel2.Stop()
    ' myChannel4.Stop()
    ' myChannel2.Play(gameOverMusic)
    continue.Hide()
    pause.Hide()
    play.Show()
    msgBox.Text = "Has perdido, \nTu puntuaci√≥n ha sido de " & lblPoints.Text & "."
    msgBox.Show()
    myTimer.Stop()

  
  Else 
    
    If steps = 10 Or steps = 20 Then 
      lblTime.Text = Val(lblTime.Text) + 1
    Endif
    If steps = 20 Then
      
       mySnake.growUp()
       lblPoints.Text = Val(lblPoints.Text) + 10
       steps = 1
       
       ' myChannel4.Stop()
       ' myChannel3.Play(growingUpMusic)
       
    Else
      
       mySnake.move()
       ' myChannel3.Stop()
       ' myChannel4.Play(movingMusic)
    Endif
    steps = steps + 1 
   Endif

  game.Refresh()

End

Public Sub game_Draw()

  If (mySnake <> Null) Then 
    
     mySnake.draw(game)
     
  Endif

End

Public Sub exit_Click()

  FMain.Close()
  ' myChannel1.Stop()
  ' myChannel2.Stop()
  ' myChannel3.Stop()
  ' myChannel4.Stop()

End

Public Sub pause_Click()
  
  ' myChannel1.Pause()
  ' myChannel3.Pause()
  ' myChannel4.Pause()
  myTimer.Stop()

End

Public Sub continue_Click()

 ' myChannel1.Play()
 ' myChannel3.Play()
 ' myChannel4.Play()
 myTimer.Start()


End

Public Sub Form_KeyPress()

  If Key.Text = "w" Or Key.Text = "a" Or Key.Text = "s" Or Key.Text = "d" Then
    
    mySnake.changeDirecction(Key.Text, mySnake.getLastDirecction())
  
  Else If Key.Text = "W" Then
  
  mySnake.changeDirecction("w", mySnake.getLastDirecction())
  
  Else If Key.Text = "A" Then
  
  mySnake.changeDirecction("a", mySnake.getLastDirecction())
  
  Else If Key.Text = "S" Then
    
    mySnake.changeDirecction("s", mySnake.getLastDirecction())
    
  Else If Key.Text = "D" Then
    
    mySnake.changeDirecction("d", mySnake.getLastDirecction())
    
  Endif

End
