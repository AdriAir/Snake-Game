' Gambas class file

Private mySnake As Snake
Private steps As Integer
Private myChannel1 As Channel
Private myChannel2 As Channel
Private myChannel3 As Channel
Private backgroundMusic As Sound
Public gameOverMusic As Sound 
Private growUpMusic As Sound 

Public Sub play_Click()

  msgBox.Hide()
  play.Hide()
  continue.Show()
  pause.Show()
  mySnake = New Snake(200, 300, Color.Yellow, "d")
  steps = 1
  myTimer.Start()
  
  myChannel1.Play(backgroundMusic)
  
End

Public Sub myTimer_Timer()
  
  If mySnake.isInHimself() = True Or mySnake.isOutOfClient(game) = True Then
   
    myChannel1.Stop()
    myChannel2.Play(gameOverMusic)
    continue.Hide()
    pause.Hide()
    play.Show()
    msgBox.Text = "Has perdido, \nTu puntuaci√≥n ha sido de " & lblPoints.Text & "."
    msgBox.Show()
    myTimer.Stop()

  
  Else 
    
    steps = steps + 1 
    
    If steps = 20 Then
      
       mySnake.growUp()
       steps = 1
       
       myChannel3.Play(growUpMusic)
       myChannel3.Volume = 50
       
    Else
      
       mySnake.move()
       
    Endif
       
   Endif

  game.Refresh()

End

Public Sub game_Draw()

  If (mySnake <> Null) Then 
    
     mySnake.draw(game)
     
  Endif

End

Public Sub exit_Click()

  FMain.Close()

End

Public Sub pause_Click()
  
  myChannel1.Pause()
  myTimer.Stop()

End

Public Sub continue_Click()

 myChannel1.Play(backgroundMusic)
 myTimer.Start()


End

Public Sub Form_Open()

  Channels.Count = 3
  myChannel1 = Channels[0]
  myChannel2 = Channels[1]
  myChannel3 = Channels[2]
  backgroundMusic.Load("./assets/background.wav")
  gameOverMusic.Load("./assets/gameOver.wav")
  growUpMusic.Load("./assets/growUp.wav")
  msgBox.Hide()
  continue.Hide()
  pause.Hide()

End

Public Sub Form_KeyPress()

  If Key.Text = "w" Or Key.Text = "a" Or Key.Text = "s" Or Key.Text = "d" Then
    
    mySnake.changeDirecction(Key.Text, mySnake.getLastDirecction())
  
  Else If Key.Text = "W" Then
  
  mySnake.changeDirecction("w", mySnake.getLastDirecction())
  
  Else If Key.Text = "A" Then
  
  mySnake.changeDirecction("a", mySnake.getLastDirecction())
  
  Else If Key.Text = "S" Then
    
    mySnake.changeDirecction("s", mySnake.getLastDirecction())
    
  Else If Key.Text = "D" Then
    
    mySnake.changeDirecction("d", mySnake.getLastDirecction())
    
  Endif

End
